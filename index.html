<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İnkılap Tarihi Akıllı Çalışma Kağıdı Asistanı</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #0056b3;
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, button {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            box-sizing: border-box;
            margin-top: 5px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        #sonuc-alani {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
            border: 1px solid #ced4da;
            white-space: pre-wrap;
        }
        .loading {
            text-align: center;
            font-style: italic;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>İnkılap Tarihi Akıllı Çalışma Kağıdı Asistanı</h1>

        <div class="form-group">
            <label for="unite-secimi">Ünite Seçimi:</label>
            <select id="unite-secimi">
                <option value="">Lütfen bir ünite seçiniz</option>
                </select>
        </div>

<div class="form-group">
            <label for="kazanim-secimi">Kazanım Seçimi:</label>
            <select id="kazanim-secimi" disabled>
                <option value="">Lütfen önce ünite seçiniz</option>
            </select>
        </div>

        <div class="form-group">
            <label for="kaynak-secimi">Kaynak Seçimi:</label>
            <select id="kaynak-secimi" disabled>
                <option value="">Lütfen önce kazanım seçiniz</option>
            </select>
        </div>

        <button id="olustur-butonu" disabled>Çalışma Kağıdı Oluştur</button>

        <div id="kaynak-basligi" style="margin-top: 20px; display: none;">
            <h3>Kullanılan Birinci Elden Kaynak:</h3>
        </div>
        <div id="kaynak-alani" style="padding: 15px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; white-space: pre-wrap; margin-bottom: 20px;">
            </div>

        <div id="sonuc-basligi" style="margin-top: 20px; display: none;">
            <h3>Oluşturulan Çalışma Kağıdı:</h3>
        </div>
        <div id="sonuc-alani">
            </div>

<script>
    const API_ENDPOINT_URL = 'https://duwr3ymxi6.execute-api.eu-central-1.amazonaws.com/';

    const uniteSecimi = document.getElementById('unite-secimi');
    const kazanimSecimi = document.getElementById('kazanim-secimi');
    const kaynakSecimi = document.getElementById('kaynak-secimi');
    const olusturButonu = document.getElementById('olustur-butonu');
    const kaynakBasligi = document.getElementById('kaynak-basligi');
    const kaynakAlani = document.getElementById('kaynak-alani');
    const sonucBasligi = document.getElementById('sonuc-basligi');
    const sonucAlani = document.getElementById('sonuc-alani');

    const mockUniteler = [
        { id: "1", ad: "1. 20. Yüzyıl Başlarında Osmanlı Devleti ve Dünya" },
        { id: "2", ad: "2. Milli Mücadele" },
        { id: "3", ad: "3. Atatürkçülük ve Türk İnkılabı" },
        { id: "4", ad: "4. İki Savaş Arasındaki Dönemde Türkiye ve Dünya" },
        { id: "5", ad: "5. II.Dünya Savaşı Sürecinde Türkiye ve Dünya" },
        { id: "6", ad: "6. II.Dünya Savaşı Sonrasında Türkiye ve Dünya" },
        { id: "7", ad: "7. Toplumsal Devrim Çağında Dünya ve Türkiye" },
        { id: "8", ad: "8. 21. Yüzyılın Eşiğinde Türkiye ve Dünya" }
    ];

    const mockKazanimlar = {
        "1": [
            { id: "1.1", ad: "1.1. Mustafa Kemal’in Birinci Dünya Savaşı’na kadarki eğitim ve askerlik hayatını içinde bulunduğu toplumun siyasi, sosyal ve kültürel yapısı ile ilişkilendirir" },
            { id: "1.2", ad: "1.2. 20. yüzyıl başlarında Osmanlı Devleti’nin siyasi, sosyal ve ekonomik durumunu analiz eder." },
            { id: "1.3", ad: "1.3. I. Dünya Savaşı sürecinde Osmanlı Devleti’nin durumunu siyasi, askerî ve sosyal açılardan analiz eder." },
            { id: "1.4", ad: "1.4. I. Dünya Savaşı’nın sonuçlarını Osmanlı Devleti ve Batılı devletler açısından değerlendirir." }
        ],
        "2": [
            { id: "2.1", ad: "2.1. Kuvay-ı Millîye hareketinin oluşumundan Büyük Millet Meclisinin açılışına kadar olan süreçte meydana gelen gelişmeleri açıklar." },
            { id: "2.2", ad: "2.2. Büyük Millet Meclisinin açılış sürecini ve sonrasında meydana gelen gelişmeleri kavrar." },
            { id: "2.3", ad: "2.3. Sevr Antlaşması’nın Millî Mücadele sürecine etkilerini analiz eder." },
            { id: "2.4", ad: "2.4. Doğu ve Güney Cephelerinde verilen mücadelelerin ülkemizin bağımsızlık sürecine katkılarını kavrar." },
            { id: "2.5", ad: "2.5. Düzenli ordunun kurulmasından Mudanya Ateşkes Antlaşması’na kadar meydana gelen gelişmeleri Türkiye’nin bağımsızlık sürecine katkıları açısından analiz eder." },
            { id: "2.6", ad: "2.6. Millî Mücadele sonucunda kazanılan diplomatik başarıları ülkemizin bağımsızlığı açısından değerlendirir.2.6. Millî Mücadele sonucunda kazanılan diplomatik başarıları ülkemizin bağımsızlığı açısından değerlendirir." },
            { id: "2.7", ad: "2.7. Millî Mücadele sürecine katkıda bulunmuş önemli şahsiyetlerin kişilik özellikleri ile faaliyetlerini ilişkilendirir." }
        ],
        "3": [
            { id: "3.1", ad: "3.1. Çağdaşlaşan Türkiye’nin temeli olan Atatürk ilkelerini kavrar." },
            { id: "3.2", ad: "3.2. Siyasi alanda meydana gelen gelişmeleri kavrar." },
            { id: "3.3", ad: "3.3. Hukuk alanında meydana gelen gelişmelerin Türk toplumunda meydana getirdiği değişimleri kavrar." },
            { id: "3.4", ad: "3.4. Eğitim ve kültür alanında yapılan inkılapları ve gelişmeleri kavrar." },
            { id: "3.5", ad: "3.5. Toplumsal alanda yapılan inkılapları ve meydana gelen gelişmeleri kavrar." },
            { id: "3.6", ad: "3.6. Ekonomi alanında meydana gelen gelişmeleri kavrar." },
            { id: "3.7", ad: "3.7. Atatürk Dönemi’nde sağlık alanında yapılan çalışmaları kavrar." },
            { id: "3.8", ad: "3.7. Atatürk ilke ve inkılaplarını oluşturan temel esasları Atatürkçü düşünce sistemi açısından analiz eder." },
        ],
        "4": [
            { id: "4.1", ad: "4.1. Atatürk Dönemi’nde Türkiye Cumhuriyeti’nin iç politikasındaki önemli gelişmeleri açıklar." },
            { id: "4.2", ad: "4.2. Atatürk Dönemi’nde (1923-1938) Türkiye Cumhuriyeti’nin dış politikasındaki başlıca gelişmeleri açıklar. " },
            { id: "4.3", ad: "4.3. İki dünya savaşı arasındaki dönemde dünyada meydana gelen siyasi ve ekonomik gelişmeleri kavrar." },
        ],
        "5": [
            { id: "5.1", ad: "5.1. II. Dünya Savaşı’nın sebepleri, başlaması ve yayılmasıyla ilgili başlıca gelişmeleri kavrar" },
            { id: "5.2", ad: "5.2. II. Dünya Savaşı sürecinde Türkiye’nin izlediği siyaset ile savaşın Türkiye üzerindeki ekonomik ve toplumsal etkilerini analiz eder." },
            { id: "5.3", ad: "5.3. II. Dünya Savaşı’nın sonuçlarını değerlendirir." },
        ],
        "6": [
            { id: "6.1", ad: "6.1. 1945-1950 yılları arasında Türkiye’de meydana gelen siyasi, sosyal ve ekonomik gelişmeleri kavrar." },
            { id: "6.2", ad: "6.2. II. Dünya Savaşı sonrası dönemde uluslararası ilişkilerde ve Türk dış politikasında meydana gelen gelişmeleri kavrar." },
            { id: "6.3", ad: "6.3. 1950’ler Türkiye’sinde meydana gelen siyasi, sosyal ve ekonomik gelişmeleri analiz eder." },
        ],
        "7": [
            { id: "7.1", ad: "7.1. 1960 sonrasında dünya siyasetinde ortaya çıkan gelişmeleri açıklar." },
            { id: "7.2", ad: "7.2. 1960’lardan itibaren Türk dış politikasını etkileyen önemli gelişmeleri kavrar." },
            { id: "7.3", ad: "7.3. 1960’lardan itibaren Türkiye’de meydana gelen siyasi, ekonomik ve sosyo-kültürel gelişmeleri analiz eder." },
        ],
        "8": [
            { id: "8.1", ad: "8.1. 1990 sonrasında Türkiye’de meydana gelen ekonomik, siyasi, sosyal ve kültürel gelişmeleri kavrar." },
            { id: "8.2", ad: "8.2. 1990 sonrasında meydana gelen siyasi gelişmeleri Türkiye’ye etkileri ve dünya siyasi konjonktürü bağlamında analiz eder." },
        ]
    };

    function uniteleriYukle() {
        mockUniteler.forEach(unite => {
            const option = document.createElement('option');
            option.value = unite.id;
            option.textContent = unite.ad;
            uniteSecimi.appendChild(option);
        });
    }

    function kazanımlariGuncelle(uniteId) {
        kazanimSecimi.innerHTML = '<option value="">Lütfen bir kazanım seçiniz</option>';
        olusturButonu.disabled = true;
        if (uniteId) {
            kazanimSecimi.disabled = false;
            const secilenUniteninKazanimlari = mockKazanimlar[uniteId] || [];
            secilenUniteninKazanimlari.forEach(kazanim => {
                const option = document.createElement('option');
                option.value = kazanim.id;
                option.textContent = kazanim.ad;
                kazanimSecimi.appendChild(option);
            });
        } else {
            kazanimSecimi.disabled = true;
            kazanimSecimi.innerHTML = '<option value="">Lütfen önce ünite seçiniz</option>';
        }
    }

    function formatlaCalismaKagidi(metin) {
        let htmlCiktisi = '';
        const satirlar = metin.split('\n');
        satirlar.forEach(satir => {
            satir = satir.trim();
            if (satir === '') return;

            if (satir.startsWith('Soru') || satir.startsWith('Bu metne göre')) {
                htmlCiktisi += `<p><strong>${satir}</strong></p>`;
            }
            else if (satir.match(/^[a-d]\)/i)) {
                htmlCiktisi += `<p style="margin-left: 20px;">${satir}</p>`;
            }

            else {
                htmlCiktisi += `<p>${satir}</p>`;
            }
        });
        return htmlCiktisi;
    }
        
    async function kaynaklariYukle(unitId, outcomeId) {
        kaynakSecimi.innerHTML = '<option value="">Kaynaklar yükleniyor...</option>';
        olusturButonu.disabled = true;

        try {
            const response = await fetch(API_ENDPOINT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ unit_id: unitId, outcome_id: outcomeId }),
            });
            const kaynaklar = await response.json();

            kaynakSecimi.innerHTML = '<option value="">Lütfen bir kaynak seçiniz</option>';
            if (kaynaklar.length > 0) {
                kaynakSecimi.disabled = false;
                kaynaklar.forEach(kaynak => {
                    const option = document.createElement('option');
                    option.value = kaynak.source_id;
                    option.textContent = kaynak.source_title;
                    kaynakSecimi.appendChild(option);
                });
            } else {
                kaynakSecimi.innerHTML = '<option value="">Bu kazanıma ait kaynak bulunamadı</option>';
                kaynakSecimi.disabled = true;
            }
        } catch (error) {
            console.error("Kaynakları yüklerken hata oluştu:", error);
            kaynakSecimi.innerHTML = '<option value="">Kaynaklar yüklenemedi</option>';
            kaynakSecimi.disabled = true;
        }
    }

    async function calismaKagidiOlustur() {
        console.log("calismaKagidiOlustur fonksiyonu BAŞLADI!");


        const secilenUniteId = uniteSecimi.value;
        const secilenKaynakId = kaynakSecimi.value;
        
        kaynakAlani.textContent = '';
        sonucAlani.innerHTML = '<p class="loading">Çalışma kağıdı hazırlanıyor, lütfen bekleyiniz...</p>';
        kaynakBasligi.style.display = 'none';
        sonucBasligi.style.display = 'none';
        olusturButonu.disabled = true;

        try {

            const istekVerisi = {
                unit_id: secilenUniteId,
                source_id: secilenKaynakId
            };

            const response = await fetch(API_ENDPOINT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(istekVerisi),
            });

            const veri = await response.json();
            console.log("Backend'den gelen ham cevap:", veri);

            if (!response.ok) {
                throw new Error(veri.message || `Sunucudan hata kodu alındı: ${response.status}`);
            }

            const formatlanmisHtml = formatlaCalismaKagidi(veri.calisma_kagidi);
            sonucAlani.innerHTML = formatlanmisHtml;
            kaynakAlani.textContent = veri.kullanilan_kaynak;
            kaynakBasligi.style.display = 'block';
            sonucBasligi.style.display = 'block';

        } catch (error) {
            console.error('Hata:', error);
            sonucAlani.innerHTML = `<p style="color: red;">${error.message}</p>`;
            kaynakBasligi.style.display = 'none';
            sonucBasligi.style.display = 'none';
        } finally {
            olusturButonu.disabled = false;
        }
    }
    document.addEventListener('DOMContentLoaded', uniteleriYukle);

    uniteSecimi.addEventListener('change', (event) => {
        const secilenUniteId = event.target.value;
        kazanımlariGuncelle(secilenUniteId);
        kaynakSecimi.innerHTML = '<option value="">Lütfen önce kazanım seçiniz</option>';
        kaynakSecimi.disabled = true;
        olusturButonu.disabled = true;
    });
    
    kazanimSecimi.addEventListener('change', () => {
        const secilenUniteId = uniteSecimi.value;
        const secilenKazanimId = kazanimSecimi.value;
        if (secilenKazanimId) {
            kaynaklariYukle(secilenUniteId, secilenKazanimId);
        } else {
            kaynakSecimi.innerHTML = '<option value="">Lütfen önce kazanım seçiniz</option>';
            kaynakSecimi.disabled = true;
            olusturButonu.disabled = true;
        }
    });

    kaynakSecimi.addEventListener('change', () => {
        if (kaynakSecimi.value) {
            olusturButonu.disabled = false;
        } else {
            olusturButonu.disabled = true;
        }
    });
    
    olusturButonu.addEventListener('click', calismaKagidiOlustur);
</script>
</body>
</html>